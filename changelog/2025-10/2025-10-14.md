# Changelog - October 14, 2025

## üöÄ New Features

### QOP Orchestrator Enhancements
- **Added `--info` command**: `./qop.py --info --region us-east-1 --profile qop`
  - Shows comprehensive deployment information from CloudFormation stacks
  - Displays API URLs, UI URLs, table names, queue URLs, and ARNs
  - Includes quick links to all UI pages (Dashboard, Findings, Inventory, Management)
  - Shows stack status with timestamps and health indicators
  - Provides ready-to-use curl commands for API testing

### UI Deployment Improvements
- **Enhanced domain display**: UI deployment now shows CloudFront domain and all page URLs
- **CloudFront cache invalidation**: Automatic cache invalidation after UI deployment
- **Environment variable handling**: Improved API URL injection during build process
- **Custom domain support**: Added infrastructure for custom domain setup with SSL certificates

### SPA Routing Fix
- **Fixed CloudFront 404 errors**: Updated error responses to serve `index.html` for 404/403 errors
- **Enabled client-side routing**: URLs like `/findings`, `/inventory`, `/management` now work correctly
- **Improved user experience**: Direct navigation to any page now works without errors

## üèóÔ∏è Infrastructure Changes

### CloudFront Configuration
- Updated error responses to support Single Page Application routing
- 404/403 errors now serve `index.html` with 200 status instead of `404.html`
- Enables proper Next.js client-side routing

### CDK Stack Outputs
- Added `UiUrl` output to WebStack for better integration
- Enhanced stack outputs with comprehensive deployment information
- Improved backward compatibility for existing deployments

## üîß Developer Experience

### Repository Structure
- **Mono-repo decision**: Documented decision to maintain mono-repo structure
- **Created ARCHITECTURE.md**: Comprehensive documentation of repository structure and decisions
- **Added development setup script**: `./tools/dev_setup.sh` for automated environment setup
- **Updated documentation**: Improved README.md with better quick start instructions

### Testing & Quality
- **Enhanced exception handling**: Proper stack traces across all Lambda functions
- **Improved error reporting**: Better debugging capabilities with fail-fast principles
- **Added comprehensive unit tests**: New test files for API endpoints and manager integration

## üêõ Bug Fixes

### Build Process
- **Fixed virtual environment usage**: CDK commands now properly use virtual environment
- **Package manager detection**: Automatic detection of pnpm vs npm based on lock files
- **Duplicate CDK construct**: Removed duplicate CfnOutput constructs causing deployment failures

### UI Deployment
- **Fixed API URL injection**: Environment variables now properly passed to Next.js build
- **Temporary .env.local handling**: Prevents local development settings from affecting deployment
- **CloudFront cache management**: Automatic invalidation ensures immediate updates

## üìö Documentation Updates

- **Updated help text**: Enhanced qop.py help with new --info command
- **API documentation**: Comprehensive API endpoint documentation
- **Custom domain guide**: Step-by-step guide for setting up custom domains
- **Architecture documentation**: Detailed mono-repo structure and decision rationale

## üîÑ Maintenance

### Code Organization
- **Moved setup script**: Relocated from `scripts/setup.sh` to `tools/dev_setup.sh`
- **Cleaned up imports**: Organized imports and dependencies across modules
- **Enhanced error handling**: Consistent exception handling patterns across codebase

### Performance
- **Caching improvements**: Enhanced caching in data access managers
- **Optimized queries**: Better DynamoDB query patterns for improved performance
- **Reduced redundant calls**: Eliminated duplicate API calls in UI components
